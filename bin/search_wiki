#!/usr/bin/env ruby

if File.symlink?(__FILE__) and ENV["RBENV_VERSION"]
  ENV["RBENV_VERSION"] = nil
  shims_path = File.expand_path("shims", ENV["RBENV_ROOT"])
  ENV["PATH"] = shims_path + ":" + ENV["PATH"]
  exec(File.readlink(__FILE__), *ARGV)
end

topdir = File.expand_path("../../", __FILE__)
ENV["BUNDLE_GEMFILE"] = topdir + "/Gemfile"

require 'rubygems'
require 'bundler/setup'
Bundler.require

require "pp"

## main

config = SearchWiki::Config.new('~/.config/search_wiki/config.yml')
repo_name = config['REPOSITORY'].split('/').slice(-1)
Dir.chdir(topdir + "/target_repo")
if File.exist?(repo_name)
  begin
    Dir.chdir(topdir + "/target_repo/#{repo_name}")
    `git pull origin master`
  rescue
    puts "error"
  end
else
  begin
    `git clone git@github.com:#{config['REPOSITORY']}.git`
  rescue
    puts "error"
  end
end
